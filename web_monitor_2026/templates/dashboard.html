<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Options Trading Bot 2026</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <style>
        /* Dark theme with green accents */
        body {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            color: #e0e0e0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .navbar-dark {
            background: linear-gradient(90deg, #1e3c72 0%, #2a5298 100%) !important;
            border-bottom: 2px solid #4CAF50;
        }
        
        .card {
            margin-bottom: 20px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
            background: linear-gradient(145deg, #2a2a2a, #333333);
            border: 1px solid #404040;
            border-radius: 12px;
        }
        
        .card-header {
            background: linear-gradient(90deg, #2d2d2d, #383838);
            border-bottom: 2px solid #4CAF50;
            border-radius: 12px 12px 0 0 !important;
            color: #4CAF50;
            font-weight: 600;
        }
        .strategy-card {
            border-left: 4px solid #4CAF50;
        }
        .volatile-strategy {
            border-left: 4px solid #FF9800;
        }
        .bull-strategy {
            border-left: 4px solid #4CAF50;
        }
        .bear-strategy {
            border-left: 4px solid #F44336;
        }
        .metric-card {
            text-align: center;
            padding: 15px;
            background: rgba(76, 175, 80, 0.1);
            border-radius: 8px;
            margin: 5px 0;
        }
        .metric-value {
            font-size: 24px;
            font-weight: bold;
            color: #4CAF50;
        }
        .metric-label {
            color: #b0b0b0;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .trade-list {
            max-height: 400px;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            padding: 10px;
        }
        .error-list {
            max-height: 200px;
            overflow-y: auto;
            background: rgba(244, 67, 54, 0.1);
            border-radius: 8px;
            padding: 10px;
        }
        .action-card {
            border-left: 4px solid #6c757d;
            background: rgba(255, 255, 255, 0.05);
        }
        .action-open {
            border-left-color: #4CAF50;
        }
        .action-close {
            border-left-color: #F44336;
        }
        .action-scan {
            border-left-color: #2196F3;
        }
        .action-error {
            border-left-color: #F44336;
        }
        .stock-scroll {
            max-height: 200px;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 10px;
            background: linear-gradient(145deg, #1a1a1a, #252525);
            border-radius: 8px;
            margin-top: 10px;
            border: 1px solid #404040;
        }
        .stock-item {
            padding: 8px;
            margin: 5px 0;
            background: linear-gradient(90deg, rgba(76, 175, 80, 0.1), rgba(76, 175, 80, 0.05));
            border-radius: 6px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
            border-left: 3px solid #4CAF50;
        }
        .stock-item:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 8px rgba(76, 175, 80, 0.3);
            background: linear-gradient(90deg, rgba(76, 175, 80, 0.2), rgba(76, 175, 80, 0.1));
        }
        .stock-symbol {
            font-weight: bold;
            font-size: 14px;
            color: #4CAF50;
        }
        .stock-score {
            font-size: 12px;
            padding: 3px 10px;
            border-radius: 12px;
            color: white;
            font-weight: bold;
        }
        .score-positive {
            background: linear-gradient(45deg, #4CAF50, #66BB6A);
        }
        .score-negative {
            background: linear-gradient(45deg, #F44336, #EF5350);
        }
        .score-neutral {
            background: linear-gradient(45deg, #9E9E9E, #BDBDBD);
        }
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .stock-item.new-item {
            animation: fadeIn 0.5s ease;
        }
        
        /* Activity Log Styles */
        .activity-log {
            height: 500px;
            max-height: 500px;
            overflow-y: auto;
            overflow-x: hidden;
            background: linear-gradient(145deg, #0a0a0a, #1a1a1a);
            color: #e0e0e0;
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.5;
            border-radius: 0 0 12px 12px;
            border: 1px solid #333;
            position: relative;
        }
        
        .activity-log::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, #4CAF50, #2196F3, #4CAF50);
            animation: pulse 2s ease-in-out infinite alternate;
        }
        
        @keyframes pulse {
            0% { opacity: 0.6; }
            100% { opacity: 1; }
        }
        
        .activity-item {
            padding: 10px 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            white-space: pre-wrap;
            word-wrap: break-word;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .activity-item:hover {
            background: linear-gradient(90deg, rgba(76, 175, 80, 0.1), rgba(33, 150, 243, 0.1));
            transform: translateX(5px);
        }
        
        .activity-item.new-activity {
            animation: highlightActivity 3s ease;
        }
        
        @keyframes highlightActivity {
            0% { 
                background: linear-gradient(90deg, rgba(76, 175, 80, 0.3), rgba(76, 175, 80, 0.1));
                transform: scale(1.02);
            }
            100% { 
                background: transparent;
                transform: scale(1);
            }
        }
        
        .activity-timestamp {
            color: #81C784;
            font-weight: bold;
            margin-right: 8px;
            text-shadow: 0 0 2px rgba(129, 199, 132, 0.3);
        }
        
        .activity-component {
            color: #FFC107;
            font-weight: bold;
            margin-right: 8px;
            padding: 2px 6px;
            background: rgba(255, 193, 7, 0.1);
            border-radius: 4px;
            border-left: 3px solid #FFC107;
        }
        
        .activity-level-info {
            color: #64B5F6;
        }
        
        .activity-level-success {
            color: #4CAF50;
            text-shadow: 0 0 3px rgba(76, 175, 80, 0.3);
        }
        
        .activity-level-warning {
            color: #FF9800;
            text-shadow: 0 0 3px rgba(255, 152, 0, 0.3);
        }
        
        .activity-level-error {
            color: #F44336;
            text-shadow: 0 0 3px rgba(244, 67, 54, 0.3);
        }
        
        .activity-level-debug {
            color: #9E9E9E;
        }
        
        /* Mini sections */
        .recent-actions-mini {
            max-height: 200px;
            overflow-y: auto;
            padding: 10px;
            background: linear-gradient(145deg, #1a1a1a, #252525);
            border-radius: 8px;
        }
        
        .recent-actions-mini .action-item {
            padding: 8px;
            margin: 6px 0;
            background: linear-gradient(90deg, rgba(76, 175, 80, 0.1), rgba(76, 175, 80, 0.05));
            border-radius: 6px;
            border-left: 3px solid #4CAF50;
            font-size: 12px;
            color: #e0e0e0;
            transition: all 0.3s ease;
        }
        
        .recent-actions-mini .action-item:hover {
            transform: translateX(3px);
            background: linear-gradient(90deg, rgba(76, 175, 80, 0.2), rgba(76, 175, 80, 0.1));
        }
        
        .recent-actions-mini .action-open {
            border-left-color: #4CAF50;
        }
        
        .recent-actions-mini .action-close {
            border-left-color: #F44336;
        }
        
        .recent-actions-mini .action-scan {
            border-left-color: #2196F3;
        }
        
        .error-list {
            max-height: 200px;
            overflow-y: auto;
            padding: 10px;
            background: linear-gradient(145deg, #2a1a1a, #352525);
            border-radius: 8px;
        }
        
        .error-item {
            padding: 8px;
            margin: 6px 0;
            background: linear-gradient(90deg, rgba(244, 67, 54, 0.2), rgba(244, 67, 54, 0.1));
            border-radius: 6px;
            border-left: 3px solid #F44336;
            font-size: 12px;
            color: #FFCDD2;
            transition: all 0.3s ease;
        }
        
        .error-item:hover {
            transform: translateX(3px);
            background: linear-gradient(90deg, rgba(244, 67, 54, 0.3), rgba(244, 67, 54, 0.2));
        }
        
        /* Button styles */
        .btn-outline-secondary {
            border-color: #4CAF50;
            color: #4CAF50;
            background: transparent;
        }
        
        .btn-outline-secondary:hover {
            background: #4CAF50;
            border-color: #4CAF50;
            color: #000;
        }
        
        .btn-outline-primary {
            border-color: #2196F3;
            color: #2196F3;
            background: transparent;
        }
        
        .btn-outline-primary:hover {
            background: #2196F3;
            border-color: #2196F3;
            color: #fff;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-dark bg-dark">
        <div class="container-fluid">
            <span class="navbar-brand mb-0 h1">Options Trading Bot 2026</span>
            <span class="navbar-text" id="bot-status">Status: <span class="badge bg-secondary">Stopped</span></span>
        </div>
    </nav>

    <div class="container-fluid mt-4">
        <div class="row">
            <!-- Portfolio Overview -->
            <div class="col-md-3">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">Portfolio Overview</h5>
                    </div>
                    <div class="card-body">
                        <div class="metric-card">
                            <div class="metric-value" id="portfolio-value">$0.00</div>
                            <div class="metric-label">Portfolio Value</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" id="daily-pnl">$0.00</div>
                            <div class="metric-label">Daily P&L</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" id="total-pnl">$0.00</div>
                            <div class="metric-label">Total P&L</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Active Trades -->
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">Active Trades</h5>
                    </div>
                    <div class="card-body">
                        <div class="trade-list" id="active-trades">
                            <!-- Trades will be inserted here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Risk Metrics -->
            <div class="col-md-3">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">Risk Metrics</h5>
                    </div>
                    <div class="card-body">
                        <div id="risk-metrics">
                            <!-- Risk metrics will be inserted here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mt-4">
            <!-- Activity Log -->
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="card-title mb-0">üîç Real-Time Activity Log</h5>
                        <div>
                            <button class="btn btn-sm btn-outline-secondary" onclick="clearActivityLog()">Clear</button>
                            <button class="btn btn-sm btn-outline-primary" onclick="pauseActivityLog()">
                                <span id="pause-text">Pause</span>
                            </button>
                        </div>
                    </div>
                    <div class="card-body p-0">
                        <div class="activity-log" id="activity-log">
                            <div class="text-muted text-center py-3">Waiting for bot activity...</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Actions & Errors -->
            <div class="col-md-4">
                <div class="row">
                    <!-- Recent Trade Actions -->
                    <div class="col-12 mb-3">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="card-title mb-0">Recent Trade Actions</h6>
                            </div>
                            <div class="card-body p-0">
                                <div class="recent-actions-mini" id="recent-actions">
                                    <!-- Actions will be inserted here -->
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Errors -->
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="card-title mb-0">Errors</h6>
                            </div>
                            <div class="card-body p-0">
                                <div class="error-list" id="errors">
                                    <!-- Errors will be inserted here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mt-4">
            <!-- Market Sentiment -->
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">Market Sentiment</h5>
                        <small class="text-muted">Real-time market analysis</small>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="metric-card">
                                    <div class="metric-value" id="current-sentiment">NEUTRAL</div>
                                    <div class="metric-label">Current Sentiment</div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="metric-card">
                                    <div class="metric-value" id="spy-change">0.00%</div>
                                    <div class="metric-label">SPY Change</div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="metric-card">
                                    <div class="metric-value" id="spy-price">$0.00</div>
                                    <div class="metric-label">SPY Price</div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="metric-card">
                                    <div class="metric-value" id="vix-level">0.00</div>
                                    <div class="metric-label">VIX Level</div>
                                </div>
                            </div>
                        </div>
                        <div class="mt-3">
                            <small class="text-muted">Last updated: <span id="sentiment-last-update">Never</span></small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Health Status -->
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">System Health</h5>
                    </div>
                    <div class="card-body">
                        <div id="health-status">
                            <!-- Health status will be inserted here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mt-4">
            <!-- Stock Screening Results -->
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">Stock Screening Results</h5>
                        <small class="text-muted">Sophisticated S&P 500 analysis with 300+ stocks</small>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <!-- Bull Stocks -->
                            <div class="col-md-4">
                                <h6 class="text-success">üêÇ Bullish Stocks</h6>
                                <div class="stock-scroll" id="bull-stocks">
                                    <!-- Bull stocks will be inserted here -->
                                </div>
                            </div>
                            <!-- Bear Stocks -->
                            <div class="col-md-4">
                                <h6 class="text-danger">üêª Bearish Stocks</h6>
                                <div class="stock-scroll" id="bear-stocks">
                                    <!-- Bear stocks will be inserted here -->
                                </div>
                            </div>
                            <!-- Volatile Stocks -->
                            <div class="col-md-4">
                                <h6 class="text-warning">‚ö° Volatile Stocks</h6>
                                <div class="stock-scroll" id="volatile-stocks">
                                    <!-- Volatile stocks will be inserted here -->
                                </div>
                            </div>
                        </div>
                        <div class="mt-3">
                            <small class="text-muted">Last screened: <span id="last-screened">Never</span></small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.socket.io/4.0.1/socket.io.min.js"></script>
    <script>
        const socket = io();
        let lastUpdate = null;

        socket.on('connect', () => {
            console.log('Connected to server');
        });

        socket.on('status_update', (data) => {
            updateDashboard(data);
        });

        socket.on('activity_log', (activityData) => {
            addActivityLogEntry(activityData);
        });

        function updateDashboard(data) {
            // Update portfolio metrics
            document.getElementById('portfolio-value').textContent = formatCurrency(data.portfolio_value);
            document.getElementById('daily-pnl').textContent = formatCurrency(data.daily_pnl);
            document.getElementById('total-pnl').textContent = formatCurrency(data.total_pnl);

            // Update bot status
            const statusBadge = document.querySelector('#bot-status .badge');
            statusBadge.textContent = data.bot_status;
            statusBadge.className = `badge ${getStatusClass(data.bot_status)}`;

            // Update active trades
            const tradesContainer = document.getElementById('active-trades');
            tradesContainer.innerHTML = data.active_trades.map(trade => createTradeCard(trade)).join('');

            // Update recent actions  
            const actionsContainer = document.getElementById('recent-actions');
            actionsContainer.innerHTML = data.recent_actions.map(action => createMiniActionCard(action)).join('');

            // Update errors
            const errorsContainer = document.getElementById('errors');
            errorsContainer.innerHTML = data.errors.map(error => createMiniErrorCard(error)).join('');

            // Update risk metrics
            const riskMetricsContainer = document.getElementById('risk-metrics');
            riskMetricsContainer.innerHTML = createRiskMetrics(data.risk_metrics);

            // Update market sentiment
            if (data.market_sentiment) {
                updateMarketSentiment(data.market_sentiment);
            }

            // Update health status
            if (data.health_metrics) {
                updateHealthStatus(data.health_metrics);
            }

            // Update stock screening results
            if (data.screening_results) {
                updateScreeningResults(data.screening_results);
            }

            lastUpdate = new Date(data.last_update);
        }

        function updateMarketSentiment(sentimentData) {
            // Update current sentiment with color coding
            const sentimentElement = document.getElementById('current-sentiment');
            const sentiment = sentimentData.current_sentiment || 'NEUTRAL';
            sentimentElement.textContent = sentiment.toUpperCase();
            
            // Color code sentiment
            sentimentElement.className = 'metric-value';
            if (sentiment.toLowerCase().includes('bull')) {
                sentimentElement.style.color = '#28a745'; // Green
            } else if (sentiment.toLowerCase().includes('bear')) {
                sentimentElement.style.color = '#dc3545'; // Red
            } else if (sentiment.toLowerCase().includes('volatile')) {
                sentimentElement.style.color = '#ffc107'; // Yellow
            } else {
                sentimentElement.style.color = '#6c757d'; // Gray
            }

            // Update SPY data
            const spyPrice = sentimentData.spy_last || 0;
            const spyChange = sentimentData.spy_change || 0;
            
            document.getElementById('spy-price').textContent = formatCurrency(spyPrice);
            
            const spyChangeElement = document.getElementById('spy-change');
            const changePercent = (spyChange * 100).toFixed(2);
            spyChangeElement.textContent = (changePercent >= 0 ? '+' : '') + changePercent + '%';
            spyChangeElement.style.color = spyChange >= 0 ? '#28a745' : '#dc3545';

            // Update VIX level
            const vixLevel = sentimentData.vix_level || 0;
            const vixElement = document.getElementById('vix-level');
            vixElement.textContent = vixLevel.toFixed(2);
            vixElement.style.color = vixLevel > 20 ? '#dc3545' : '#28a745';

            // Update last update time
            if (sentimentData.last_update) {
                document.getElementById('sentiment-last-update').textContent = 
                    new Date(sentimentData.last_update).toLocaleTimeString();
            }
        }

        function updateHealthStatus(healthData) {
            const healthContainer = document.getElementById('health-status');
            
            const healthItems = [
                { key: 'ibkr_connection', label: 'IBKR Connection' },
                { key: 'execution_engine', label: 'Execution Engine' },
                { key: 'risk_manager', label: 'Risk Manager' },
                { key: 'portfolio_provider', label: 'Portfolio Provider' },
                { key: 'news_handler', label: 'News Handler' },
                { key: 'stock_screener', label: 'Stock Screener' }
            ];

            const healthHtml = healthItems.map(item => {
                const status = healthData[item.key] || false;
                const statusClass = status ? 'text-success' : 'text-danger';
                const statusIcon = status ? '‚úÖ' : '‚ùå';
                const statusText = status ? 'Online' : 'Offline';
                
                return `
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <span>${item.label}</span>
                        <span class="${statusClass}">${statusIcon} ${statusText}</span>
                    </div>
                `;
            }).join('');

            healthContainer.innerHTML = healthHtml;
        }

        function updateScreeningResults(screeningData) {
            // Update bull stocks
            const bullContainer = document.getElementById('bull-stocks');
            updateStockList(bullContainer, screeningData.bull || []);

            // Update bear stocks
            const bearContainer = document.getElementById('bear-stocks');
            updateStockList(bearContainer, screeningData.bear || []);

            // Update volatile stocks
            const volatileContainer = document.getElementById('volatile-stocks');
            updateStockList(volatileContainer, screeningData.volatile || []);

            // Update last screened time
            const lastScreenedElement = document.getElementById('last-screened');
            if (screeningData.last_update) {
                lastScreenedElement.textContent = new Date(screeningData.last_update).toLocaleTimeString();
            }
        }

        function updateStockList(container, stocks) {
            const existingSymbols = new Set(
                Array.from(container.querySelectorAll('.stock-item')).map(el => el.dataset.symbol)
            );

            // Clear container
            container.innerHTML = '';

            // Add stocks
            stocks.forEach((stock, index) => {
                const [symbol, score, rank] = stock;
                const stockElement = createStockItem(symbol, score, rank);
                
                // Add animation for new items
                if (!existingSymbols.has(symbol)) {
                    stockElement.classList.add('new-item');
                }
                
                // Add with slight delay for cascade effect
                setTimeout(() => {
                    container.appendChild(stockElement);
                }, index * 50);
            });

            // Show placeholder if no stocks
            if (stocks.length === 0) {
                container.innerHTML = '<div class="text-muted text-center">No stocks found</div>';
            }
        }

        function createStockItem(symbol, score, rank) {
            const div = document.createElement('div');
            div.className = 'stock-item';
            div.dataset.symbol = symbol;
            
            const scoreClass = score > 0 ? 'score-positive' : score < 0 ? 'score-negative' : 'score-neutral';
            const scoreFormatted = (score * 100).toFixed(1);
            
            div.innerHTML = `
                <div>
                    <span class="stock-symbol">${symbol}</span>
                    <small class="text-muted ms-2">#${rank}</small>
                </div>
                <span class="stock-score ${scoreClass}">${scoreFormatted > 0 ? '+' : ''}${scoreFormatted}%</span>
            `;
            
            return div;
        }

        function formatCurrency(value) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD'
            }).format(value);
        }

        function getStatusClass(status) {
            switch (status.toLowerCase()) {
                case 'running':
                    return 'bg-success';
                case 'stopped':
                    return 'bg-danger';
                case 'paused':
                    return 'bg-warning';
                default:
                    return 'bg-secondary';
            }
        }

        function createTradeCard(trade) {
            const strategyClass = getStrategyClass(trade.strategy);
            return `
                <div class="card strategy-card ${strategyClass} mb-2">
                    <div class="card-body">
                        <h6 class="card-title">${trade.symbol} - ${trade.strategy}</h6>
                        <p class="card-text">
                            Entry: ${formatCurrency(trade.entry_price)}<br>
                            Current: ${formatCurrency(trade.current_price)}<br>
                            P&L: ${formatCurrency(trade.pnl)} (${trade.pnl_pct}%)
                        </p>
                    </div>
                </div>
            `;
        }

        function createActionCard(action) {
            const actionClass = getActionClass(action.type);
            return `
                <div class="card action-card ${actionClass} mb-2">
                    <div class="card-body">
                        <h6 class="card-title">${action.type} - ${action.symbol}</h6>
                        <p class="card-text">
                            Strategy: ${action.strategy}<br>
                            Time: ${new Date(action.timestamp).toLocaleString()}<br>
                            Details: ${JSON.stringify(action.details, null, 2)}
                        </p>
                    </div>
                </div>
            `;
        }

        function createErrorCard(error) {
            return `
                <div class="card border-danger mb-2">
                    <div class="card-body">
                        <h6 class="card-title text-danger">${error.type}</h6>
                        <p class="card-text">
                            ${error.message}<br>
                            Time: ${new Date(error.timestamp).toLocaleString()}<br>
                            ${error.details ? `Details: ${JSON.stringify(error.details, null, 2)}` : ''}
                        </p>
                    </div>
                </div>
            `;
        }

        function createRiskMetrics(metrics) {
            return `
                <div class="metric-card">
                    <div class="metric-value">${formatCurrency(metrics.max_trade_size)}</div>
                    <div class="metric-label">Max Trade Size</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">${formatCurrency(metrics.daily_loss)}</div>
                    <div class="metric-label">Daily Loss</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">${metrics.active_trailing_stops}</div>
                    <div class="metric-label">Active Trailing Stops</div>
                </div>
            `;
        }

        function getStrategyClass(strategy) {
            if (strategy.toLowerCase().includes('volatile')) {
                return 'volatile-strategy';
            } else if (strategy.toLowerCase().includes('bull')) {
                return 'bull-strategy';
            } else if (strategy.toLowerCase().includes('bear')) {
                return 'bear-strategy';
            }
            return '';
        }

        function getActionClass(actionType) {
            switch (actionType.toLowerCase()) {
                case 'open':
                    return 'action-open';
                case 'close':
                    return 'action-close';
                case 'scan':
                    return 'action-scan';
                case 'error':
                    return 'action-error';
                default:
                    return '';
            }
        }

        // Activity Log Variables
        let activityLogPaused = false;
        let maxActivityLogEntries = 200;

        function addActivityLogEntry(activityData) {
            if (activityLogPaused) return;

            const activityLogContainer = document.getElementById('activity-log');
            
            // Clear placeholder if this is the first entry
            if (activityLogContainer.querySelector('.text-muted')) {
                activityLogContainer.innerHTML = '';
            }

            // Create activity entry
            const activityEntry = document.createElement('div');
            activityEntry.className = 'activity-item new-activity';
            
            const timestamp = new Date(activityData.timestamp).toLocaleTimeString();
            const component = activityData.component || 'SYSTEM';
            const level = activityData.level || 'info';
            const message = activityData.message || '';

            activityEntry.innerHTML = `
                <span class="activity-timestamp">[${timestamp}]</span>
                <span class="activity-component">[${component}]</span>
                <span class="activity-level-${level}">${message}</span>
            `;

            // Add to top of log
            activityLogContainer.insertBefore(activityEntry, activityLogContainer.firstChild);

            // Limit entries
            while (activityLogContainer.children.length > maxActivityLogEntries) {
                activityLogContainer.removeChild(activityLogContainer.lastChild);
            }

            // Auto-scroll to top for new entries
            activityLogContainer.scrollTop = 0;
        }

        function clearActivityLog() {
            const activityLogContainer = document.getElementById('activity-log');
            activityLogContainer.innerHTML = '<div class="text-muted text-center py-3">Activity log cleared</div>';
        }

        function pauseActivityLog() {
            activityLogPaused = !activityLogPaused;
            const pauseButton = document.getElementById('pause-text');
            pauseButton.textContent = activityLogPaused ? 'Resume' : 'Pause';
            
            if (activityLogPaused) {
                addActivityLogEntry({
                    timestamp: new Date().toISOString(),
                    component: 'UI',
                    level: 'warning',
                    message: '‚è∏Ô∏è Activity logging paused'
                });
            } else {
                addActivityLogEntry({
                    timestamp: new Date().toISOString(),
                    component: 'UI', 
                    level: 'success',
                    message: '‚ñ∂Ô∏è Activity logging resumed'
                });
            }
        }

        function createMiniActionCard(action) {
            const actionClass = getActionClass(action.type);
            const timestamp = new Date(action.timestamp).toLocaleTimeString();
            return `
                <div class="action-item ${actionClass}">
                    <div><strong>${action.type.toUpperCase()}</strong> ${action.symbol}</div>
                    <div class="text-muted">${action.strategy} ‚Ä¢ ${timestamp}</div>
                </div>
            `;
        }

        function createMiniErrorCard(error) {
            const timestamp = new Date(error.timestamp).toLocaleTimeString();
            return `
                <div class="error-item">
                    <div><strong>${error.type}</strong></div>
                    <div>${error.message}</div>
                    <div class="text-muted">${timestamp}</div>
                </div>
            `;
        }
    </script>
</body>
</html>
